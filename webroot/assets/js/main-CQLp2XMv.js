const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/about-fJmkQe8m.js","assets/js/core-CSZe8cb_.js","assets/js/logs-Cbjsngkf.js","assets/js/settings-Bm1SVIU6.js","assets/js/status-BUKxly5E.js"])))=>i.map(i=>d[i]);
!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const t={},e=function(e,n,a){let s=Promise.resolve();if(n&&n.length>0){let e=function(t){return Promise.all(t.map(t=>Promise.resolve(t).then(t=>({status:"fulfilled",value:t}),t=>({status:"rejected",reason:t}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=a?.nonce||a?.getAttribute("nonce");s=e(n.map(e=>{if((e=function(t){return"/ModuleWebUI/"+t}(e))in t)return;t[e]=!0;const n=e.endsWith(".css"),a=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const s=document.createElement("link");return s.rel=n?"stylesheet":"modulepreload",n||(s.as="script"),s.crossOrigin="",s.href=e,i&&s.setAttribute("nonce",i),document.head.appendChild(s),n?new Promise((t,n)=>{s.addEventListener("load",t),s.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function i(t){const e=new Event("vite:preloadError",{cancelable:!0});if(e.payload=t,window.dispatchEvent(e),!e.defaultPrevented)throw t}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})},n=(t,e,n)=>{const a=t[e];return a?"function"==typeof a?a():Promise.resolve(a):new Promise((t,a)=>{("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==n?". Note that variables only represent file names one level deep.":""))))})},a={currentLang:"zh",supportedLangs:["zh","en","ru"],translations:{zh:{},en:{},ru:{}},moduleTranslations:{zh:{},en:{},ru:{}},config:{enableModuleTranslations:!1,reloadOnLanguageChange:!1},configure(t={}){return Object.assign(this.config,t),this},async init(){try{return await this.determineInitialLanguage(),this.observeDOMChanges(),this.loadTranslationsAsync(),document.dispatchEvent(new CustomEvent("i18nReady",{detail:{language:this.currentLang}})),!0}catch(t){return this.currentLang="zh",!1}},async loadTranslationsAsync(){try{if(await this.loadTranslations(),this.applyTranslations(),document.dispatchEvent(new CustomEvent("translationsLoaded",{detail:{language:this.currentLang}})),this.config.enableModuleTranslations)try{await this.loadModuleTranslations(),this.applyTranslations()}catch(t){}}catch(t){this.translations.zh=this.getBaseTranslations(),this.applyTranslations()}},async loadTranslations(){try{const t=this.supportedLangs.map(async t=>{try{const a=(await n(Object.assign({"./assets/translations/en.json":()=>e(()=>import("./en-CaqxGi7W.js"),[]),"./assets/translations/ru.json":()=>e(()=>import("./ru-BRIjaAIj.js"),[]),"./assets/translations/zh.json":()=>e(()=>import("./zh-DrTjvQI5.js"),[])}),`./assets/translations/${t}.json`,4)).default;if(!("object"==typeof a&&Object.keys(a).length>0))throw new Error(`${t}语言文件格式无效`);this.translations[t]=a}catch(a){"zh"===t&&(this.translations.zh=this.getBaseTranslations())}});await Promise.all(t),this.supportedLangs.forEach(t=>{this.translations[t]&&0!==Object.keys(this.translations[t]).length||(this.translations[t]=this.getBaseTranslations())})}catch(t){this.translations.zh=this.getBaseTranslations()}},async loadModuleTranslations(){const t=Object.assign({});if(0===Object.keys(t).length)return;const e=Object.entries(t).map(async([t,e])=>{try{const n=t.match(/\/([^/]+)\.json$/)?.[1];if(!n||!this.supportedLangs.includes(n))return;const a=(await e()).default;"object"==typeof a&&Object.keys(a).length>0&&(this.moduleTranslations[n]=a,this.translations[n]={...a,...this.translations[n]})}catch(n){}});await Promise.all(e)},async determineInitialLanguage(){try{const t=localStorage.getItem("currentLanguage");if(t&&this.supportedLangs.includes(t))return void(this.currentLang=t);const e=navigator.language.split("-")[0];if(this.supportedLangs.includes(e))return this.currentLang=e,void localStorage.setItem("currentLanguage",e);localStorage.setItem("currentLanguage",this.currentLang)}catch(t){localStorage.setItem("currentLanguage",this.currentLang)}},applyTranslations(){const t=this.translate("PAGE_TITLE");t&&"PAGE_TITLE"!==t&&(document.title=t);document.querySelectorAll("[data-i18n]").forEach(t=>{const e=t.getAttribute("data-i18n"),n=this.translate(e);n&&n!==e&&(t.textContent=n)});document.querySelectorAll("[data-i18n-placeholder]").forEach(t=>{const e=t.getAttribute("data-i18n-placeholder"),n=this.translate(e);n&&n!==e&&t.setAttribute("placeholder",n)});document.querySelectorAll("[data-i18n-title]").forEach(t=>{const e=t.getAttribute("data-i18n-title"),n=this.translate(e);n&&n!==e&&t.setAttribute("title",n)});document.querySelectorAll("[data-i18n-label]").forEach(t=>{const e=t.getAttribute("data-i18n-label"),n=this.translate(e);n&&n!==e&&t.querySelector(".switch-label")&&(t.querySelector(".switch-label").textContent=n)});document.querySelectorAll("[data-i18n-aria-label]").forEach(t=>{const e=t.getAttribute("data-i18n-aria-label"),n=this.translate(e);n&&n!==e&&t.setAttribute("aria-label",n)});document.querySelectorAll("[data-i18n-value]").forEach(t=>{const e=t.getAttribute("data-i18n-value"),n=this.translate(e);n&&n!==e&&t.setAttribute("value",n)})},translate(t,e=""){if(!t)return e;if(arguments.length>2&&"object"==typeof arguments[2]){let n=this.translations[this.currentLang][t]||e||t;const a=arguments[2];for(const t in a)Object.prototype.hasOwnProperty.call(a,t)&&(n=n.replace(new RegExp(`{${t}}`,"g"),a[t]));return n}return this.translations[this.currentLang][t]||e||t},async setLanguage(t){if(!this.supportedLangs.includes(t)||t===this.currentLang)return t===this.currentLang;try{const e=this.currentLang;return this.currentLang=t,localStorage.setItem("currentLanguage",t),this.config.reloadOnLanguageChange?(window.dispatchEvent(new CustomEvent("language-changed",{detail:{newLang:t,oldLang:e,reload:!0}})),window.app&&window.app.router&&window.app.router.currentPage&&await window.app.router.loadModule(window.app.router.currentPage,!0),this.applyTranslations(),document.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:t,oldLanguage:e}})),!0):(window.dispatchEvent(new CustomEvent("language-changed",{detail:{newLang:t,oldLang:e}})),this.applyTranslations(),document.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:t,oldLanguage:e}})),!0)}catch(e){return!1}},debounce(t,e){let n;return(...a)=>{clearTimeout(n),n=setTimeout(()=>t(...a),e)}},observeDOMChanges(){this.observer&&this.observer.disconnect();const t=this.debounce(()=>this.applyTranslations(),300),e=["data-i18n","data-i18n-placeholder","data-i18n-title","data-i18n-label"];this.observer=new MutationObserver(n=>{n.some(t=>"childList"===t.type?Array.from(t.addedNodes).some(t=>t.nodeType===Node.ELEMENT_NODE&&(e.some(e=>t.hasAttribute?.(e))||t.querySelector?.(`[${e.join("], [")}]`))):"attributes"===t.type&&e.includes(t.attributeName))&&t()}),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:e})}};class s{constructor(t={}){this.options={title:"",icon:"",content:"",buttons:[],className:"",closeOnOverlay:!0,closeOnEscape:!0,...t},this.overlay=null,this.dialog=null,this.isClosing=!1,this.handleOverlayClick=this.handleOverlayClick.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}show(){if(!this.overlay)return this.createModal(),document.body.appendChild(this.overlay),this.element=this.dialog,this.options.closeOnOverlay&&this.overlay.addEventListener("click",this.handleOverlayClick),this.options.closeOnEscape&&document.addEventListener("keydown",this.handleKeyDown),requestAnimationFrame(()=>{this.overlay.classList.add("show")}),this}hide(){if(this.overlay&&!this.isClosing)return this.isClosing=!0,this.overlay.removeEventListener("click",this.handleOverlayClick),document.removeEventListener("keydown",this.handleKeyDown),this.overlay.classList.add("closing"),this.dialog.classList.add("closing"),setTimeout(()=>{this.overlay&&this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.overlay=null,this.dialog=null,this.isClosing=!1},200),this}createModal(){this.overlay=document.createElement("div"),this.overlay.className=`modal-overlay ${this.options.className}`,this.dialog=document.createElement("div"),this.dialog.className="modal-dialog";let t="";this.options.title&&(t+='<div class="modal-header">',t+='<h2 class="modal-title">',t+=this.options.title,t+="</h2>",t+="</div>"),this.options.content&&(t+='<div class="modal-content">',t+=this.options.content,t+="</div>"),this.options.buttons&&this.options.buttons.length>0&&(t+='<div class="modal-footer">',this.options.buttons.forEach(e=>{const n=`modal-button ${e.type||"text"}`;t+=`<button class="${n}" data-action="${e.action||""}">`,t+=e.text||"",t+="</button>"}),t+="</div>"),this.dialog.innerHTML=t,this.overlay.appendChild(this.dialog),this.bindButtonEvents()}bindButtonEvents(){this.dialog.querySelectorAll(".modal-button").forEach(t=>{t.addEventListener("click",t=>{const e=t.target.dataset.action,n=this.options.buttons.find(t=>t.action===e);if(n&&n.onClick){!1!==n.onClick(this)&&this.hide()}else this.hide()})})}handleOverlayClick(t){t.target===this.overlay&&this.hide()}handleKeyDown(t){"Escape"===t.key&&this.hide()}updateContent(t){if(this.dialog){const e=this.dialog.querySelector(".modal-content");e&&(e.innerHTML=t)}return this}static confirm(t){const e={buttons:[{text:a.translate("CANCEL","取消"),type:"text",action:"cancel"},{text:a.translate("CONFIRM","确认"),type:"filled",action:"confirm",onClick:t.onConfirm}]};return new s({...e,...t}).show()}static alert(t){const e={buttons:[{text:a.translate("OK","确定"),type:"filled",action:"ok"}]};return new s({...e,...t}).show()}static custom(t){return new s(t).show()}}class i{constructor(t){this.pageModules=t||{},this.cache=new Map,this.loading=new Map,this.currentPage=null}async init(){addEventListener("popstate",()=>this.navigate(this.getCurrentPage(),!1))}getCurrentPage(){return location.hash.slice(1)||"status"}async navigate(t,e=!0){if(this.currentPage!==t)try{const[n]=await Promise.all([this.loadModule(t),this.deactivateCurrent()]);this.currentPage=t,this.ui?.updateNav?.(t),e&&history.pushState(null,"",`#${t}`),await this.renderPage(n,t),await this.activatePage(n,t)}catch(n){this.ui?.showError?.("页面加载失败",n.message)}}async loadModule(t,e=!1){if(e&&(this.cache.delete(t),this.loading.delete(t)),this.cache.has(t))return this.cache.get(t);if(this.loading.has(t))return await this.loading.get(t);const n=this.loadModuleInternal(t,e);this.loading.set(t,n);try{const e=await n;return this.loading.delete(t),e}catch(a){throw this.loading.delete(t),a}}async loadModuleInternal(t,e=!1){let n=this.pageModules[t];if(!n){let e=0;const a=30;for(;!n&&e<a;)await new Promise(t=>setTimeout(t,50)),n=this.pageModules[t],e++;if(!n)throw new Error(`Module not found after waiting: ${t}`)}if(e&&(n._initialized=!1),!n._initialized&&n.init){if(!1===await n.init(this.ui))throw new Error(`Init failed: ${t}`);n._initialized=!0}return this.cache.set(t,n),n}async deactivateCurrent(){if(!this.currentPage)return;const t=this.cache.get(this.currentPage)||this.pageModules[this.currentPage];if(t?.onDeactivate)try{await t.onDeactivate()}catch(e){}}async renderPage(t,e){const n=document.getElementById("main-content");if(!n)return;n.querySelector(".page-container")?.remove();const a=document.createElement("div");a.className="page-container";const s=window.app?.cache?.get(`${e}-html`);a.innerHTML=s||t.render(),n.appendChild(a),requestAnimationFrame(()=>a.classList.add("slide-in"))}async activatePage(t,e){try{await(t.afterRender?.()),await(t.onActivate?.())}catch(n){}requestAnimationFrame(()=>{this.ui?.updatePageTitle?.(e),this.ui?.updatePageActions?.(e)})}}class o{constructor(){this.elements={},this.pageActions=new Map,this.activeActions=new Set,this.navItems=new Map,this.systemButtons=new Map}async init(){this.updateElements(),this.initNav(),this.initLanguage(),document.addEventListener("languageChanged",()=>{this.router?.currentPage&&(this.updatePageTitle(this.router.currentPage),this.updateNavLabels())}),window.addEventListener("resize",()=>{this.router?.currentPage&&this.updatePageActions(this.router.currentPage),this.updateSystemButtonsVisibility()})}updateElements(){this.elements={app:document.getElementById("app"),header:document.querySelector(".app-header"),main:document.getElementById("main-content"),title:document.getElementById("page-title"),actions:document.getElementById("page-actions"),nav:document.getElementById("app-nav")}}initNav(){if(!this.elements.nav)return;this.elements.nav.innerHTML="";const t=document.createElement("div");t.className="nav-content";const e=u(),n=h(),a=document.createElement("ul");e.forEach(t=>{const e=n[t];if(e){const n=this.createNavItem(t,e);a.appendChild(n),this.navItems.set(t,n)}}),t.appendChild(a),t.appendChild(this.createSystemActions()),this.elements.nav.appendChild(t)}createNavItem(t,e){const n=document.createElement("div");return n.className="nav-item",n.dataset.page=t,n.innerHTML=`<span class="material-symbols-rounded">${e.icon||"page_info"}</span><span class="nav-label">${this.getPageName(t,e)}</span>`,n.onclick=()=>this.router?.navigate?.(t),n}createSystemActions(){const t=document.createElement("div");t.className="system-actions";return[{id:"sidebar-language-button",icon:"language",action:()=>this.showLanguageSelector()},{id:"sidebar-theme-toggle",icon:"light_mode",action:()=>this.app.toggleTheme()}].forEach(({id:e,icon:n,action:a})=>{const s=document.createElement("button");s.id=e,s.className="icon-button",s.innerHTML=`<span class="material-symbols-rounded">${n}</span>`,s.onclick=a,t.appendChild(s),this.systemButtons.set(e,{element:s,action:a})}),t}initSystemButtons(){[{id:"theme-toggle",action:()=>this.app.toggleTheme()},{id:"language-button",action:()=>this.showLanguageSelector()}].forEach(({id:t,action:e})=>{const n=document.getElementById(t);n&&(n.onclick=t=>{t.preventDefault(),t.stopPropagation(),e()},this.systemButtons.set(t,{element:n,action:e}))}),this.updateSystemButtonsVisibility()}updateSystemButtonsVisibility(){const t=window.innerWidth>=768;["theme-toggle","language-button"].forEach(e=>{const n=document.getElementById(e);n&&(n.style.display=t?"none":"flex")}),["sidebar-theme-toggle","sidebar-language-button"].forEach(e=>{const n=document.getElementById(e);n&&(n.style.display=t?"flex":"none")})}showLanguageSelector(){this.updateLanguageOptions();const t=this.generateLanguageOptionsHtml(),e=s.custom({title:a?.translate?.("SELECT_LANGUAGE","选择语言"),icon:"🌐",content:`\n                <div class="language-options">\n                    ${t}\n                </div>\n            `,buttons:[{text:a?.translate?.("CANCEL","取消"),type:"text",action:"cancel",onClick:()=>e.hide()}],customClass:"language-selector-modal",closeOnOverlay:!0}),n=e.element.querySelector(".language-options");n&&this.bindLanguageEventsForModal(n,e),e.show()}updateNavLabels(){this.navItems.forEach((t,e)=>{const n=t.querySelector(".nav-label");n&&(n.textContent=this.getPageName(e))})}getPageName(t,e=null){if(e){const t=a?.translate?.(e.i18n_key,e.name);return t||e.name}const n=h()[t];if(n){const t=a?.translate?.(n.i18n_key,n.name);return t||n.name}}updateNav(t){this.navItems.forEach((e,n)=>{e.classList.toggle("active",n===t)})}updatePageTitle(t){this.elements.title&&(this.elements.title.textContent=this.getPageName(t)||"K50SoundBoostPlus WebUI")}registerPageActions(t,e){const n=e.filter(t=>t.id&&t.icon);this.pageActions.set(t,n),this.router?.currentPage===t&&this.updatePageActions(t)}updatePageActions(t){this.clearActiveActions();const e=this.pageActions.get(t)||[];window.innerWidth>=768?(this.renderActions(this.getSidebarActionsContainer(),e,t),this.clearContainer(this.elements.actions)):(this.renderActions(this.elements.actions,e,t),this.clearContainer(this.getSidebarActionsContainer()))}clearActiveActions(){this.activeActions.forEach(t=>{const e=document.getElementById(t);e&&e.replaceWith(e.cloneNode(!0))}),this.activeActions.clear()}getSidebarActionsContainer(){let t=document.querySelector(".nav-content .page-actions");if(!t){t=document.createElement("div"),t.className="page-actions";const e=document.querySelector(".nav-content"),n=document.querySelector(".nav-content .system-actions");e&&e.insertBefore(t,n||null)}return t}clearContainer(t){t&&(t.innerHTML="")}renderActions(t,e,n){t&&(t.innerHTML=e.map(t=>`<button id="${t.id}" class="icon-button" title="${t.title}">\n                <span class="material-symbols-rounded">${t.icon}</span>\n            </button>`).join(""),this.bindActionEvents(e,n))}bindActionEvents(t,e){t.forEach(t=>{const n=document.getElementById(t.id);n&&t.onClick&&(this.activeActions.add(t.id),n.onclick=()=>{const n=this.router?.pageModules?.[e];n?.[t.onClick]?.()})})}clearPageActions(t){this.clearActiveActions(),this.clearContainer(this.elements.actions),this.clearContainer(this.getSidebarActionsContainer()),t&&this.pageActions.delete(t)}initLanguage(){const t=document.getElementById("language-selector");if(!t)return;t.onclick=e=>{e.target===t&&(e.preventDefault(),e.stopPropagation(),this.app.overlayManager.hide(t))};const e=document.getElementById("cancel-language");e&&(e.onclick=e=>{e.preventDefault(),e.stopPropagation(),this.app.overlayManager.hide(t)}),this.updateLanguageOptions()}updateLanguageOptions(){const t=document.getElementById("language-options");t&&(t.innerHTML=this.generateLanguageOptionsHtml(),this.bindLanguageEvents(t))}generateLanguageOptionsHtml(){return a?.supportedLangs?.length?a.supportedLangs.map(t=>`<div class="language-option ${t===a.currentLang?"selected":""}" data-lang="${t}">\n                <input type="radio" name="language" id="lang-${t}" value="${t}" ${t===a.currentLang?"checked":""} class="radio">\n                <label for="lang-${t}">${this.getLanguageName(t)}</label>\n            </div>`).join(""):(a?.supportedLangs?.length||document.addEventListener("i18nReady",()=>this.updateLanguageOptions(),{once:!0}),'<div class="no-languages">Loading languages...</div>')}bindLanguageEventsForModal(t,e){t.onclick=async t=>{t.preventDefault(),t.stopPropagation();const n=t.target.closest(".language-option");if(!n)return;const s=n.dataset.lang;s&&s!==a.currentLang&&(await a.setLanguage(s),e.hide())}}bindLanguageEvents(t){const e=document.getElementById("language-selector");t.onclick=async t=>{t.preventDefault(),t.stopPropagation();const n=t.target.closest(".language-option");if(n){const t=n.dataset.lang;this.app.overlayManager.hide(e),t!==a.currentLang&&await a.setLanguage(t)}}}getLanguageName(t){return{zh:"中文",en:"English",ru:"Русский"}[t]||t.toUpperCase()}showError(t,e){this.elements.main&&(this.elements.main.innerHTML=`<div class="page-container"><div class="error-container"><h2>${t}</h2><p>${e}</p></div></div>`)}}class r{constructor(){this.activeOverlays=new Set,this.animationDuration=200}show(t){t&&!this.activeOverlays.has(t)&&(this.activeOverlays.add(t),t.style.display="flex",requestAnimationFrame(()=>{t.classList.add("active")}))}hide(t){if(!t||!this.activeOverlays.has(t)||t.classList.contains("closing"))return;t.classList.remove("active"),t.classList.add("closing");const e=()=>{t.classList.remove("closing"),t.style.display="none",this.activeOverlays.delete(t),t.removeEventListener("transitionend",e)};t.addEventListener("transitionend",e,{once:!0}),setTimeout(()=>{t.classList.contains("closing")&&e()},this.animationDuration)}hideAll(){this.activeOverlays.forEach(t=>this.hide(t))}isActive(t){return this.activeOverlays.has(t)}}const l=new class{constructor(){this.state={currentPage:null,theme:"light",config:null,isLoading:!0},this.cache=new Map,this.preloadCache=new Map,this.overlayManager=new r,this.preloadQueue=[],this.isPreloading=!1,window.addEventListener("language-changed",()=>this.cache.clear())}initTheme(){const t=matchMedia("(prefers-color-scheme: dark)").matches;this.setTheme(localStorage.getItem("theme")||(t?"dark":"light")),matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{localStorage.getItem("theme")||this.setTheme(t.matches?"dark":"light")})}setTheme(t){document.documentElement.setAttribute("data-theme",t),this.state.theme=t,localStorage.setItem("theme",t);const e=document.querySelector('meta[name="theme-color"]');e&&(e.content=getComputedStyle(document.documentElement).getPropertyValue("--primary").trim()),this.updateThemeIcons()}updateThemeIcons(){const t="dark"===this.state.theme?"dark_mode":"light_mode";["theme-toggle","sidebar-theme-toggle"].forEach(e=>{const n=document.getElementById(e);if(n){const e=n.querySelector(".material-symbols-rounded");e&&(e.textContent=t)}})}toggleTheme(){this.setTheme("dark"===this.state.theme?"light":"dark")}async init(t={},e=null){try{const n=this.loadConfig(),a=Promise.resolve().then(()=>this.initTheme());this.router=new i(t),this.ui=new o,this.router.ui=this.ui,this.ui.router=this.router,this.ui.app=this;const s=this.ui.init(),[r]=await Promise.all([n]);this.state.config=r,await Promise.all([a,s]),await this.router.init();const l=this.router.getCurrentPage(),c=this.router.navigate(l,!1),d=Promise.resolve().then(()=>this.startPreloading(t,l));await c,d.catch(t=>{}),this.finishLoading(),e&&e.then(()=>{document.addEventListener("translationsLoaded",()=>{this.ui?.updateNavLabels?.(),this.ui?.updatePageTitle?.(l)},{once:!0})}).catch(t=>{})}catch(n){this.showError("应用初始化失败")}}async loadConfig(){try{const t=await fetch("/api/config");return t.ok?await t.json():{title:"K50SoundBoostPlus WebUI",version:"1.0.0"}}catch{return{title:"K50SoundBoostPlus WebUI",version:"1.0.0"}}}startPreloading(t,e){const n=()=>{this.preloadQueue=Object.keys(t).filter(t=>t!==e),this.processPreloadQueue(t)};window.requestIdleCallback?requestIdleCallback(n,{timeout:2e3}):setTimeout(n,1e3)}async processPreloadQueue(t){if(!this.isPreloading&&this.preloadQueue.length){for(this.isPreloading=!0;this.preloadQueue.length>0;){const e=this.preloadQueue.shift();t[e]&&await this.preloadPage(e,t[e]),await new Promise(t=>{window.requestIdleCallback?requestIdleCallback(t,{timeout:500}):setTimeout(t,100)})}this.isPreloading=!1}}async preloadPage(t,e){if(!this.preloadCache.has(t))if(this.router?.cache?.has(t))this.preloadCache.set(t,!0);else{this.preloadCache.set(t,!0);try{if(e?.preload&&await e.preload(),e?.getHTML){const n=await e.getHTML();this.cache.set(`${t}-html`,n)}}catch(n){}}}finishLoading(){document.body.classList.add("app-loaded"),this.state.isLoading=!1,window.LoadingManager?.setAppReady?.(!0),this.ui.initSystemButtons()}showError(t){const e=document.getElementById("main-content");e&&(e.innerHTML=`<div class="error-container"><h2>启动失败</h2><p>${t.message||t}</p><button onclick="location.reload()">重新加载</button></div>`),window.LoadingManager?.setAppReady?.(!0)}};class c{static ready={dom:!1,app:!1};static check(){if(this.ready.dom&&this.ready.app){const t=document.getElementById("loading-screen");t&&(t.style.opacity="0",setTimeout(()=>t.remove(),300)),document.body.classList.add("app-loaded")}}static mark(t){this.ready[t]=!0,this.check()}}const d={status:{id:"status",name:"状态",icon:"dashboard",module:"StatusPage",i18n_key:"NAV_STATUS",order:1},logs:{id:"logs",name:"日志",icon:"article",module:"LogsPage",i18n_key:"NAV_LOGS",order:2},settings:{id:"settings",name:"设置",icon:"settings",module:"SettingsPage",i18n_key:"NAV_SETTINGS",order:3},about:{id:"about",name:"关于",icon:"info",module:"AboutPage",i18n_key:"NAV_ABOUT",order:4}},h=()=>({...d}),u=()=>Object.keys(d).sort((t,e)=>d[t].order-d[e].order),g=new Map,m=new Map,p=async()=>{const t=u(),a=t.map(t=>(async t=>{if(g.has(t))return g.get(t);if(m.has(t))return await m.get(t);const a=n(Object.assign({"./pages/about.js":()=>e(()=>import("./about-fJmkQe8m.js"),__vite__mapDeps([0,1])),"./pages/logs.js":()=>e(()=>import("./logs-Cbjsngkf.js"),__vite__mapDeps([2,1])),"./pages/settings.js":()=>e(()=>import("./settings-Bm1SVIU6.js"),__vite__mapDeps([3,1])),"./pages/status.js":()=>e(()=>import("./status-BUKxly5E.js"),__vite__mapDeps([4,1]))}),`./pages/${t}.js`,3);m.set(t,a);try{const e=await a;return g.set(t,e),m.delete(t),e}catch(s){throw m.delete(t),s}})(t)),s=await Promise.allSettled(a),i={};return s.forEach((e,n)=>{const a=t[n],s=d[a];if("fulfilled"===e.status&&s){const t=e.value[s.module];t&&(t.config=s,i[a]=t)}}),i};document.addEventListener("DOMContentLoaded",()=>{c.mark("dom"),document.body.classList.add("app-loaded")}),(async()=>{try{const t=a?.init?.()||Promise.resolve(),e=p(),n=await e;await l.init(n,t),c.mark("app")}catch(t){document.body.innerHTML=`<div style="display:flex;align-items:center;justify-content:center;height:100vh;flex-direction:column;font-family:system-ui;"><h2 style="color:#d32f2f;margin-bottom:1rem;">加载失败</h2><p style="color:#666;margin-bottom:2rem;">${t.message}</p><button onclick="location.reload()" style="padding:0.75rem 1.5rem;background:#1976d2;color:white;border:none;border-radius:4px;cursor:pointer;">重新加载</button></div>`,c.mark("app")}})(),setTimeout(()=>{if(!document.body.classList.contains("app-loaded")){document.body.classList.add("app-loaded");const t=document.getElementById("loading-screen");t&&t.remove()}},2e3);export{a as I,s as M,l as a};
